<div class="cart-container">
  <h1>Carrito de Compras</h1>
  <div class="cart-items">
    {{#each products}}
      <div class="cart-item">
        <h3>{{this.product.title}}</h3>
        <p>{{this.product.description}}</p>
        <p>Precio: ${{this.product.price}}</p>
        <p>Cantidad: {{this.quantity}}</p>
        <div class="item-controls">
          <input type="number" id="quantity-{{this.product._id}}" value="{{this.quantity}}" min="1">
          <button onclick="updateQuantity('{{../cartId}}', '{{this.product._id}}')">Actualizar</button>
          <button onclick="removeFromCart('{{../cartId}}', '{{this.product._id}}')">Eliminar</button>
        </div>
      </div>
    {{/each}}
  </div>
  <button onclick="clearCart('{{cartId}}')" class="clear-cart">Vaciar carrito</button>
  <a href="/products" class="continue-shopping">Continuar comprando</a>
</div>

<script>
async function updateQuantity(cartId, productId) {
  const quantity = document.getElementById(`quantity-${productId}`).value;
  try {
    await fetch(`/api/carts/${cartId}/products/${productId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ quantity: parseInt(quantity) })
    });
    location.reload();
  } catch (error) {
    console.error('Error:', error);
  }
}

async function removeFromCart(cartId, productId) {
  try {
    await fetch(`/api/carts/${cartId}/products/${productId}`, {
      method: 'DELETE'
    });
    location.reload();
  } catch (error) {
    console.error('Error:', error);
  }
}

async function clearCart(cartId) {
  try {
    await fetch(`/api/carts/${cartId}`, {
      method: 'DELETE'
    });
    location.reload();
  } catch (error) {
    console.error('Error:', error);
  }
}
</script>